{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/siyn/Desktop/edmHUB/App.vue?7f14","uni-app:///App.vue","webpack:////Users/siyn/Desktop/edmHUB/App.vue?abb4","webpack:////Users/siyn/Desktop/edmHUB/App.vue?18d6"],"names":["Vue","use","config","productionTip","prototype","$store","store","$tools","tools","App","mpType","app","mixins","mixin","$mount"],"mappings":"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","file":"common/main.js","sourcesContent":["import 'uni-pages';import Vue from 'vue'\nimport App from './App'\n\nimport store from './store'\nimport tools from './utils'\n\nimport mixin from './mixins'\n\nVue.use('uniIcon')\n\nVue.config.productionTip = false\n\nVue.prototype.$store = store\nVue.prototype.$tools = tools\n\nApp.mpType = 'app'\n\nconst app = new Vue({\n\tstore,\n\t...App,\n\tmixins:[mixin]\n})\napp.$mount()","var render, staticRenderFns, recyclableRender, components\nvar renderjs\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","import mod from \"-!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=script&lang=js&\"","<script>\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tflag: true,\n\t\t\tcommitData: {}\n\t\t};\n\t},\n\tmethods: {\n\t\tasync autoLogin() {\n\t\t\tuni.showLoading({\n\t\t\t\tmask: true,\n\t\t\t\ttitle: '登录中'\n\t\t\t});\n\t\t\tawait wx.cloud\n\t\t\t\t.callFunction({\n\t\t\t\t\tname: 'login',\n\t\t\t\t\tdata: {}\n\t\t\t\t})\n\t\t\t\t.then(async res => {\n\t\t\t\t\tlet data = res.result;\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\tconsole.log('newUser');\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log('数据库中存在该用户');\n\n\t\t\t\t\tawait this.login(data);\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '登陆成功'\n\t\t\t\t\t});\n\t\t\t\t\t// 监听msg\n\t\t\t\t\tthis.watchMsg();\n\t\t\t\t\t// 监听档案\n\t\t\t\t\tthis.watchUserInfo();\n\t\t\t\t});\n\t\t},\n\t\tasync watchMsg(code) {\n\t\t\tconst db = wx.cloud.database();\n\t\t\tlet catchLast = [];\n\t\t\tawait db\n\t\t\t\t.collection('message')\n\t\t\t\t.orderBy('date', 'desc')\n\t\t\t\t.where({\n\t\t\t\t\tuser: this.userInfo._openid\n\t\t\t\t})\n\t\t\t\t.watch({\n\t\t\t\t\tonChange: async snapshot => {\t\t\t\t\t\t\n\t\t\t\t\t\tif (this.flag === false) return; // flag\n\n\t\t\t\t\t\tlet data = snapshot.docs[0];\n\t\t\t\t\t\tthis.commitData = Object.assign({}, data);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// commitData\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.commitMsg(this.commitData);\n\t\t\t\t\t\t// 小红点\n\n\t\t\t\t\t\tlet flag1 = data.request.length; //好友请求？\n\t\t\t\t\t\tlet flag2 = false; // 新消息？\n\n\t\t\t\t\t\tlet arr = [];\n\n\t\t\t\t\t\tif (this.commitData.chats.length) {\n\t\t\t\t\t\t\tfor (let i of this.commitData.chats) {\n\t\t\t\t\t\t\t\tif (i.isNew === true) {\n\t\t\t\t\t\t\t\t\t// 下载会话\n\t\t\t\t\t\t\t\t\t// i.chatid\n\t\t\t\t\t\t\t\t\tconsole.log(i.chatid + '有新信息');\n\t\t\t\t\t\t\t\t\tarr.push(i.chatid);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlet localCatch = uni.getStorageSync(i.chatid);\n\t\t\t\t\t\t\t\t\tif (!localCatch) {\n\t\t\t\t\t\t\t\t\t\tconsole.log(i.chatid + '本地无缓存，新建');\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync(i.chatid, []);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tlet last = localCatch[localCatch.length - 1];\n\t\t\t\t\t\t\t\t\t\tif (last === catchLast) {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('重复内容');\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcatchLast = last;\n\n\t\t\t\t\t\t\t\t\t\tconsole.log('读取local缓存', last);\n\t\t\t\t\t\t\t\t\t\t// 添加last数据进入commitData\n\t\t\t\t\t\t\t\t\t\ti = Object.assign(i, { last });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (!i.isRead) {\n\t\t\t\t\t\t\t\t\tflag2 = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (flag1) {\n\t\t\t\t\t\t\tuni.showTabBarRedDot({\n\t\t\t\t\t\t\t\tindex: 2\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 线上有新内容的\n\t\t\t\t\t\tif (arr.length) {\n\t\t\t\t\t\t\tconsole.log('检测到new');\n\t\t\t\t\t\t\tawait this.downlaodChat(arr);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonError: err => {\n\t\t\t\t\t\tconsole.error('the watch closed because of error', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tasync watchUserInfo() {\n\t\t\tconst db = wx.cloud.database();\n\t\t\tawait db\n\t\t\t\t.collection('users')\n\t\t\t\t.where({\n\t\t\t\t\t_openid: this.userInfo._openid\n\t\t\t\t})\n\t\t\t\t.watch({\n\t\t\t\t\tonChange: snapshot => {\n\t\t\t\t\t\tconst data = snapshot.docs[0];\n\t\t\t\t\t\tif (snapshot.docChanges[0].dataType === 'init') return; // 避开初始化\n\t\t\t\t\t\tconsole.log('watch到userInfo改变');\n\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\tthis.update(data);\n\t\t\t\t\t},\n\t\t\t\t\tonError: err => {\n\t\t\t\t\t\tconsole.error('the watch closed because of error', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tasync downlaodChat(chatsArr) {\n\t\t\tuni.showTabBarRedDot({\n\t\t\t\tindex: 2\n\t\t\t});\n\t\t\t// console.log('this.commitData',this.commitData)\n\t\t\tconst db = wx.cloud.database();\n\t\t\tconst _ = db.command;\n\t\t\t// 拉取未读的聊天\n\t\t\t// 拉取之后删除\n\t\t\t// 清除isNew新消息标示\n\t\t\tawait wx.cloud\n\t\t\t\t.callFunction({\n\t\t\t\t\tname: 'getChatData',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlist: chatsArr\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(async res => {\n\t\t\t\t\tconst data = res.result.data;\n\t\t\t\t\tconsole.log('下载线上聊天', data);\n\n\t\t\t\t\tfor (let item of data) {\n\t\t\t\t\t\t// 并入本地缓存\n\t\t\t\t\t\tlet localCatch = uni.getStorageSync(item._id);\n\t\t\t\t\t\tif (!localCatch.length) {\n\t\t\t\t\t\t\tlocalCatch = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tuni.setStorageSync(item._id, localCatch.concat(item.dialoge));\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.updateNow(true)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\t// 清除isNew\n\t\t\t\t\tthis.clearIsNew(chatsArr);\n\t\t\t\t});\n\t\t\tconsole.log('dowmloadChat执行结束');\n\t\t},\n\t\tasync clearIsNew(list) {\n\t\t\tthis.flag = false;\n\t\t\twx.cloud\n\t\t\t\t.callFunction({\n\t\t\t\t\tname: 'clearIsNew',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlist\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(res => {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('clearIsNew');\n\t\t\t\t\t// 重新启动监听\n\t\t\t\t\tthis.flag = true;\n\t\t\t\t});\n\t\t}\n\t},\n\tonLaunch: function() {\n\t\tif (!wx.cloud) {\n\t\t\tconsole.error('不支持云能力');\n\t\t} else {\n\t\t\twx.cloud.init({\n\t\t\t\tenv: 'dev-0033',\n\t\t\t\ttraceUser: true\n\t\t\t});\n\t\t\t// 自动登录\n\t\t\tthis.autoLogin();\n\t\t}\n\t}\n};\n</script>\n\n<style>\npage {\n\tbackground: #161616;\n}\n</style>\n","import mod from \"-!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1605062365900\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}