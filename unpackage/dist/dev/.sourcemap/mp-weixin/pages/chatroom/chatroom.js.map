{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/siyn/Desktop/edmHUB/pages/chatroom/chatroom.vue?8a00","webpack:////Users/siyn/Desktop/edmHUB/pages/chatroom/chatroom.vue?92ba","webpack:////Users/siyn/Desktop/edmHUB/pages/chatroom/chatroom.vue?e4cd","uni-app:///pages/chatroom/chatroom.vue","webpack:////Users/siyn/Desktop/edmHUB/pages/chatroom/chatroom.vue?69be","webpack:////Users/siyn/Desktop/edmHUB/pages/chatroom/chatroom.vue?1be7"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,qG;AACAA,UAAU,CAACC,iBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiI;AACjI;AAC4D;AACL;AACqC;;;AAG5F;AAC6M;AAC7M,gBAAgB,iNAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,+FAAM;AACR,EAAE,wGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA,WAAW,wLAEN;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACvCA;AAAA;AAAA;AAAA;AAAuzB,CAAgB,syBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsB30B,gD;;;;;;;;;;;;;;;;;;;;AADA,6B,eAEA,EACA,IADA,kBACA,CACA,SACA,WADA,EAEA,cAFA,EAGA,WAHA,EAIA,WAJA,EAKA,cALA,GAOA,CATA,EAUA,4BACA,0CADA,CAVA,EAaA,yCACA,sCADA,SAEA,MAFA,kBAEA,MAFA,EAEA,CACA;AACA,eACA,YADA,CACA,EACA,cADA,EAEA;AACA,wBADA,EAFA,EADA;;;AAOA,UAPA,CAOA;AACA;AACA,OATA;AAUA,KAdA;AAeA,UAfA,oBAeA;AACA;AACA,2BADA;AAEA,mBAFA;;AAIA,KApBA;AAqBA,QArBA,kBAqBA;AACA,sCADA;AAEA;AACA;AACA,mBAJA,GAIA,aAJA;AAKA,sBALA,GAKA,oBALA;AAMA,sBANA,GAMA,wBANA;AAOA;AACA,8BADA,CACA;AACA,mCADA;AAEA;AACA,8BADA;AAEA,oCAFA;AAGA,oCAHA,EAFA,EADA;;;AASA,sBATA,iGASA;AACA;AACA;AACA,oDAHA,wDATA,kEAPA;;AAqBA,KA1CA;AA2CA,oBA3CA,8BA2CA;AACA;AACA,4BADA,CACA,OADA;AAEA,qBAFA,CAEA,qBAFA;AAGA,uBAHA,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,uBAFA;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAxBA;AAyBA;AACA;AACA,qBA3BA,EAHA,CADA,SACA,sBADA;;AAiCA,KA5EA,GAbA;;AA2FA,QA3FA,kBA2FA,OA3FA,EA2FA;AACA;AACA;AACA;;AAEA;AACA,wBANA,GAMA,oCANA;AAOA,wBAPA,OAOA;AACA;AACA;AACA;AACA;;AAEA;AAbA,wEAcA;AACA,iDADA;;AAGA;AACA;AACA;AACA,eAHA;AAIA;AACA,wCAtBA;;AAwBA,GAnHA;AAoHA,UApHA,sBAoHA;AACA,8CADA;AAEA,GAtHA,E;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAsrC,CAAgB,2nCAAG,EAAC,C;;;;;;;;;;;ACA1sC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chatroom/chatroom.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chatroom/chatroom.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatroom.vue?vue&type=template&id=4748afe6&scoped=true&\"\nvar renderjs\nimport script from \"./chatroom.vue?vue&type=script&lang=js&\"\nexport * from \"./chatroom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatroom.vue?vue&type=style&index=0&id=4748afe6&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4748afe6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chatroom/chatroom.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=template&id=4748afe6&scoped=true&\"","var components = {\n  wordsbox: function() {\n    return import(\n      /* webpackChunkName: \"components/wordsbox/wordsbox\" */ \"@/components/wordsbox/wordsbox.vue\"\n    )\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.dialoge, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var g0 =\n      item.speaker === _vm.userInfo._openid\n        ? _vm.$tools.formatTime(item.date)\n        : null\n    var g1 = !(item.speaker === _vm.userInfo._openid)\n      ? _vm.$tools.formatTime(item.date)\n      : null\n    return {\n      $orig: $orig,\n      g0: g0,\n      g1: g1\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"dialoge\">\r\n\t\t\t<view v-for=\"(item, index) of dialoge\" :key=\"index\">\r\n\t\t\t\t<view v-if=\"item.speaker === userInfo._openid\">\r\n\t\t\t\t\t<wordsbox :avatar=\"userInfo.avatarUrl\" layout=\"se\" :content=\"item.content\" :date=\"$tools.formatTime(item.date)\"></wordsbox>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-else>\r\n\t\t\t\t\t<wordsbox :avatar=\"targetInfo.avatarUrl\" layout=\"tar\" :content=\"item.content\" :date=\"$tools.formatTime(item.date)\"></wordsbox>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"input\">\r\n\t\t\t<view class=\"inputwrap\"><textarea class=\"inputarea\" type=\"text\" v-model=\"message\" /></view>\r\n\r\n\t\t\t<span class=\"send\" @tap=\"send\"><image class=\"icon\" src=\"../../static/icon_selected/fasong.png\" mode=\"aspectFit\"></image></span>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nconst db = wx.cloud.database();\r\nimport { mapState, mapMutations } from 'vuex';\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tdialoge: [],\r\n\t\t\ttargetInfo: [],\r\n\t\t\tmessage: '',\r\n\t\t\toptions:{},\n\t\t\tsending:false\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState(['userInfo', 'chats'])\r\n\t},\r\n\tmethods: {\r\n\t\t...mapMutations(['updateNow']),\r\n\t\tisRead(chatid) {\r\n\t\t\t// 清除未读标签\r\n\t\t\twx.cloud\r\n\t\t\t\t.callFunction({\r\n\t\t\t\t\tname: 'isRead',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tchatid\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tconsole.log('已读', res);\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tscroll() {\r\n\t\t\tuni.pageScrollTo({\r\n\t\t\t\tscrollTop: 99999999,\r\n\t\t\t\tduration: 0\r\n\t\t\t});\r\n\t\t},\r\n\t\tasync send() {\n\t\t\tif(this.sending===true)return \n\t\t\t// 话要一句一句说\n\t\t\tthis.sending = true\r\n\t\t\tlet msg = this.message;\r\n\t\t\tlet chatid = this.options.chatid;\r\n\t\t\tlet target = this.targetInfo._openid;\r\n\t\t\tawait wx.cloud\r\n\t\t\t\t.callFunction({\r\n\t\t\t\t\tname: 'sendMsg',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tmsg,\r\n\t\t\t\t\t\tchatid,\r\n\t\t\t\t\t\ttarget\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.then(async res => {\r\n\t\t\t\t\tconsole.log(`发送${msg}给${target}`, res.result);\r\n\t\t\t\t\tthis.message = '';\n\t\t\t\t\tthis.sending = false\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tasync watchCurrentChat() {\r\n\t\t\tthis.chatRoomWatcher = await db\r\n\t\t\t\t.collection('chats')\r\n\t\t\t\t.doc(this.options.chatid)\r\n\t\t\t\t.watch({\r\n\t\t\t\t\tonChange: snapshot => {\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet newDialoge = snapshot.docs[0].dialoge;\r\n\t\t\t\t\t\tif(snapshot.docChanges[0].dataType==='init'){\r\n\t\t\t\t\t\t\tconsole.log('init,不执行啧监听逻辑到此为止')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!newDialoge || !newDialoge.length) return;\r\n\t\t\t\t\t\tnewDialoge = newDialoge[newDialoge.length - 1];\r\n\r\n\t\t\t\t\t\t// 页面\r\n\t\t\t\t\t\tthis.dialoge = this.dialoge.concat(newDialoge);\r\n\r\n\t\t\t\t\t\t// 滚动到底部\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.scroll();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// 缓存\r\n\t\t\t\t\t\tconst oldCatch = uni.getStorageSync(this.options.chatid);\r\n\t\t\t\t\t\tuni.setStorageSync(this.options.chatid, oldCatch.concat(newDialoge));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// last\n\t\t\t\t\t\tthis.updateNow(true)\r\n\t\t\t\t\t\t// this.updateLast({ chatid: this.options.chatid, last: newDialoge });\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonError: err => {\r\n\t\t\t\t\t\tconsole.error('the watch closed because of error', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t},\r\n\tasync onLoad(options) {\r\n\t\tconsole.log('进入聊天--->', options);\r\n\t\tthis.options = options\r\n\t\tthis.dialoge = uni.getStorageSync(options.chatid);\r\n\r\n\t\t// targetInfo\r\n\t\tconst friendData = uni.getStorageSync('friendListData');\r\n\t\tfor (let item of friendData) {\r\n\t\t\tif (item._openid === options.openid) {\r\n\t\t\t\tthis.targetInfo = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// title\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle: this.targetInfo.nickName\r\n\t\t});\r\n\t\tthis.$nextTick(() => {\r\n\t\t\t// scrollToBottom\r\n\t\t\tthis.scroll();\r\n\t\t});\r\n\t\tthis.isRead(options.chatid);\r\n\t\tthis.watchCurrentChat()\r\n\r\n\t},\r\n\tasync onUnload(){\r\n\t\tawait this.chatRoomWatcher.close()\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.dialoge {\r\n\tmin-height: 1086rpx;\r\n\toverflow: hidden;\r\n\tpadding-bottom: 10vh;\r\n}\r\n.wordsbox {\r\n\tbackground: #5fff8a;\r\n\twidth: 300rpx;\r\n}\r\n.input {\r\n\theight: 10vh;\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\tbackground: black;\r\n\twidth: 100%;\r\n\tdisplay: flex;\r\n}\r\n.input .inputwrap {\r\n\tflex: 1;\r\n\tpadding: 2%;\r\n\tcolor: #ffffff;\r\n}\r\n.input .inputwrap .inputarea {\r\n\tborder: 8rpx solid #232323;\r\n\tborder-radius: 16rpx;\r\n\theight: 100%;\r\n\tbackground: #090909;\r\n\tfont-size: 34rpx;\r\n\tpadding: 10rpx;\r\n\twidth: 100%;\r\n\tbox-sizing: border-box;\r\n}\r\n.input .send {\r\n\tflex: 0 0 100rpx;\r\n\tpadding: 3% 0;\r\n}\r\n.input .send .icon {\r\n\twidth: 80rpx;\r\n\theight: 80rpx;\r\n}\r\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=style&index=0&id=4748afe6&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=style&index=0&id=4748afe6&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1605062430876\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}